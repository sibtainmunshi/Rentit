<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bookings - Rentit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#4f46e5', primaryDark: '#4338ca' },
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] }
                }
            }
        }
    </script>
</head>
<body class="font-sans bg-gray-50">
    
    <!-- Navbar -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="/" class="flex items-center gap-2.5">
                    <div class="relative flex items-center justify-center w-10 h-10 bg-slate-900 rounded-xl shadow-lg">
                        <i class="fa-solid fa-cube text-white text-lg"></i>
                        <div class="absolute -top-1 -right-1 w-3.5 h-3.5 bg-primary rounded-full border-2 border-white"></div>
                    </div>
                    <span class="text-2xl font-bold text-slate-900">Rentit</span>
                </a>
                <a href="/" class="text-gray-600 hover:text-slate-900 font-medium">
                    <i class="fa-solid fa-arrow-left mr-2"></i> Back to Home
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-3xl font-bold text-slate-900">My Bookings</h1>
            <div class="flex gap-2">
                <button onclick="filterBookings('all')" class="px-4 py-2 rounded-lg text-sm font-semibold bg-primary text-white">All</button>
                <button onclick="filterBookings('active')" class="px-4 py-2 rounded-lg text-sm font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300">Active</button>
                <button onclick="filterBookings('completed')" class="px-4 py-2 rounded-lg text-sm font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300">Completed</button>
            </div>
        </div>

        <!-- Bookings List -->
        <div id="bookings-container" class="space-y-4">
            <!-- Will be populated by JS -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-12">
            <i class="fa-solid fa-box-open text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-bold text-slate-900 mb-2">No bookings yet</h3>
            <p class="text-gray-500 mb-6">Start exploring and book your first item!</p>
            <a href="/" class="inline-block px-6 py-3 bg-primary text-white rounded-xl font-semibold hover:bg-primaryDark transition">
                Browse Items
            </a>
        </div>
    </div>

    <script src="/static/js/firebase-auth.js"></script>
    <script>
        let allBookings = [];

        window.addEventListener('load', function() {
            const user = JSON.parse(localStorage.getItem('rentit_user') || 'null');
            if (!user || !user.loggedIn) {
                window.location.href = '/';
                return;
            }

            loadBookings();
        });

        function loadBookings() {
            allBookings = JSON.parse(localStorage.getItem('rentit_bookings') || '[]');
            renderBookings(allBookings);
        }

        function renderBookings(bookings) {
            const container = document.getElementById('bookings-container');
            const emptyState = document.getElementById('empty-state');

            if (bookings.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            container.classList.remove('hidden');
            emptyState.classList.add('hidden');

            container.innerHTML = bookings.map(booking => `
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition">
                    <div class="flex gap-6">
                        <img src="${booking.itemImage || 'https://via.placeholder.com/150'}" class="w-32 h-32 object-cover rounded-lg" alt="${booking.itemName}">
                        <div class="flex-1">
                            <div class="flex items-start justify-between mb-2">
                                <div>
                                    <h3 class="text-xl font-bold text-slate-900 mb-1">${booking.itemName}</h3>
                                    <p class="text-sm text-gray-600">Booking ID: ${booking.bookingId}</p>
                                </div>
                                <span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full">
                                    ${booking.status || 'Confirmed'}
                                </span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mt-4">
                                <div>
                                    <p class="text-sm text-gray-600">Rental Period</p>
                                    <p class="font-semibold text-slate-900">${booking.startDate} - ${booking.endDate}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Total Amount</p>
                                    <p class="font-semibold text-slate-900">${booking.totalAmount}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Contact</p>
                                    <p class="font-semibold text-slate-900">${booking.phone}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Delivery Address</p>
                                    <p class="font-semibold text-slate-900">${booking.address}</p>
                                </div>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button onclick="viewBooking('${booking.bookingId}')" class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-semibold hover:bg-primaryDark transition">
                                    View Details
                                </button>
                                <button onclick="cancelBooking('${booking.bookingId}')" class="px-4 py-2 bg-red-100 text-red-600 rounded-lg text-sm font-semibold hover:bg-red-200 transition">
                                    Cancel Booking
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterBookings(filter) {
            // Update button states
            document.querySelectorAll('button[onclick^="filterBookings"]').forEach(btn => {
                btn.className = 'px-4 py-2 rounded-lg text-sm font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300';
            });
            event.target.className = 'px-4 py-2 rounded-lg text-sm font-semibold bg-primary text-white';

            // Filter logic (for now just show all)
            renderBookings(allBookings);
        }

        function viewBooking(bookingId) {
            window.location.href = `/booking-confirmation?id=${bookingId}`;
        }

        function cancelBooking(bookingId) {
            if (confirm('Are you sure you want to cancel this booking?')) {
                allBookings = allBookings.filter(b => b.bookingId !== bookingId);
                localStorage.setItem('rentit_bookings', JSON.stringify(allBookings));
                renderBookings(allBookings);
                alert('Booking cancelled successfully');
            }
        }
    </script>
</body>
</html>
