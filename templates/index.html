<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rentit - The Rental Marketplace</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Plus Jakarta Sans for a modern tech vibe -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5', // Indigo 600
                        primaryDark: '#4338ca',
                        secondary: '#0ea5e9', // Sky Blue
                        surface: '#f8fafc',
                    },
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'card': '0 0 0 1px rgba(0,0,0,0.05), 0 2px 8px rgba(0,0,0,0.05)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-out forwards',
                        'bounce-slow': 'bounce 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .category-chip.active { background-color: #1e293b; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .hero-pattern { background-color: #4f46e5; background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }
        
        /* Cinematic Splash Screen */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f172a;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: transform 1.2s cubic-bezier(0.645, 0.045, 0.355, 1), 
                        opacity 1s cubic-bezier(0.645, 0.045, 0.355, 1), 
                        visibility 1s;
            will-change: transform, opacity;
        }
        
        .splash-loader {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }
        
        .ambient-glow {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(50px);
            animation: breathe 3s infinite ease-in-out;
        }
        
        .splash-brand-container {
            display: flex;
            align-items: center;
            z-index: 2;
            transform-style: preserve-3d;
        }
        
        .splash-logo-box {
            width: 85px;
            height: 85px;
            background: #0f172a;
            color: white;
            font-size: 2.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 24px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            animation: logoEntrance 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .splash-logo-box::before {
            content: "";
            position: absolute;
            top: -4px;
            right: -4px;
            width: 14px;
            height: 14px;
            background: #4f46e5;
            border-radius: 50%;
            border: 2px solid #0f172a;
            z-index: 10;
        }
        
        .splash-logo-box::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -150%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.4), transparent);
            transform: rotate(30deg);
            animation: shimmer 2s infinite;
        }
        
        .splash-text-reveal {
            font-size: 2.8rem;
            font-weight: 800;
            color: white;
            letter-spacing: 8px;
            overflow: hidden;
            white-space: nowrap;
            max-width: 0;
            opacity: 0;
            margin-left: 0;
            transition: all 1s cubic-bezier(0.19, 1, 0.22, 1);
        }
        
        .show-text .splash-text-reveal {
            max-width: 400px;
            opacity: 1;
            margin-left: 25px;
        }
        
        @keyframes shimmer {
            0% { left: -150%; }
            50%, 100% { left: 150%; }
        }
        
        @keyframes breathe {
            0%, 100% {
                transform: scale(1);
                opacity: 0.5;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }
        
        @keyframes logoEntrance {
            from {
                transform: scale(0.5) rotateY(-90deg);
                opacity: 0;
            }
            to {
                transform: scale(1) rotateY(0deg);
                opacity: 1;
            }
        }
        
        .fade-out {
            transform: scale(1.5);
            opacity: 0;
            visibility: hidden;
        }
    </style>
</head>
<body class="font-sans bg-surface text-slate-800 relative overflow-x-hidden">

    <!-- Cinematic Splash Screen -->
    <div id="splash-screen">
        <div class="splash-loader">
            <div class="ambient-glow"></div>
            <div class="splash-brand-container" id="brand-container">
                <div class="splash-logo-box">
                    <i class="fa-solid fa-cube"></i>
                </div>
                <div class="splash-text-reveal">RENTIT</div>
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-gray-200 transition-all">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Brand -->
                <div class="flex items-center gap-2.5 cursor-pointer group" onclick="goHome()">
                    <div class="relative flex items-center justify-center w-10 h-10 bg-slate-900 rounded-xl shadow-lg shadow-indigo-500/20 group-hover:scale-105 transition-all duration-300">
                        <i class="fa-solid fa-cube text-white text-lg group-hover:rotate-12 transition-transform duration-300"></i>
                        <div class="absolute -top-1 -right-1 w-3.5 h-3.5 bg-primary rounded-full border-2 border-white"></div>
                    </div>
                    <span class="text-2xl font-bold tracking-tight text-slate-900 group-hover:text-primary transition-colors">Rentit</span>
                </div>

                <!-- Tabs with Icons (Airbnb Style) -->
                <div class="hidden md:flex bg-gray-100 p-1 rounded-xl">
                    <button onclick="switchMainTab('products')" id="tab-products" class="px-6 py-2 rounded-lg text-sm font-semibold transition-all shadow-sm bg-white text-primary flex items-center gap-2">
                        <i class="fa-solid fa-cube text-lg"></i>
                        <span>Products</span>
                    </button>
                    <button onclick="switchMainTab('services')" id="tab-services" class="px-6 py-2 rounded-lg text-sm font-semibold text-gray-500 hover:text-gray-900 transition-all flex items-center gap-2">
                        <i class="fa-solid fa-bell-concierge text-lg"></i>
                        <span>Services</span>
                    </button>
                    <button onclick="switchMainTab('spaces')" id="tab-spaces" class="px-6 py-2 rounded-lg text-sm font-semibold text-gray-500 hover:text-gray-900 transition-all flex items-center gap-2">
                        <i class="fa-solid fa-house text-lg"></i>
                        <span>Spaces</span>
                    </button>
                </div>

                <!-- Right Actions -->
                <div class="flex items-center gap-4">
                    <!-- Wishlist Button -->
                    <button onclick="toggleWishlist()" class="relative p-2 text-gray-600 hover:text-red-500 transition group">
                        <i class="fa-regular fa-heart text-xl group-hover:scale-110 transition-transform"></i>
                        <span id="wishlist-count" class="hidden absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center border-2 border-white">0</span>
                    </button>

                    <!-- Cart Button -->
                    <button onclick="toggleCart()" class="relative p-2 text-gray-600 hover:text-primary transition group">
                        <i class="fa-solid fa-cart-shopping text-xl group-hover:scale-110 transition-transform"></i>
                        <span id="cart-count" class="hidden absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center border-2 border-white">0</span>
                    </button>

                    <!-- Auth Buttons -->
                    <div class="flex items-center gap-3">
                        <a href="/list-item" class="hidden sm:block text-sm font-medium text-gray-600 hover:text-primary transition">List Item</a>
                        <button onclick="openLoginModal()" class="bg-slate-900 hover:bg-slate-800 text-white px-5 py-2 rounded-lg text-sm font-bold transition shadow-lg shadow-slate-900/20">Sign In</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="home-view">
        <!-- Hero Section -->
        <div class="hero-pattern text-white py-12 px-4 mb-6">
            <div class="max-w-4xl mx-auto text-center">
                <h1 class="text-3xl md:text-5xl font-bold mb-4">
                    Rent Anything,<br>
                    Experience Everything.
                </h1>
                <p class="text-indigo-100 text-lg mb-6">From cameras to coders, find what you need without buying it.</p>
                <div class="bg-white p-2 rounded-2xl shadow-xl max-w-2xl mx-auto flex flex-col sm:flex-row gap-2">
                    <div class="flex-1 flex items-center px-4 bg-gray-50 rounded-xl h-12">
                        <i class="fa-solid fa-magnifying-glass text-primary mr-3"></i>
                        <input id="search-input" type="text" placeholder="Search for cameras, bikes, services..." class="bg-transparent w-full outline-none text-gray-900 placeholder-gray-500 text-sm font-medium" onkeypress="if(event.key==='Enter') performSearch()">
                    </div>
                    <div class="flex-1 flex items-center px-4 bg-gray-50 rounded-xl h-12">
                        <i class="fa-solid fa-location-dot text-primary mr-3"></i>
                        <input id="search-pincode" type="text" placeholder="Pincode (optional)" class="bg-transparent w-full outline-none text-gray-900 placeholder-gray-500 text-sm font-medium" maxlength="6" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                    </div>
                    <button onclick="performSearch()" class="bg-primary hover:bg-primaryDark text-white h-12 px-8 rounded-xl font-semibold transition shadow-md">Search</button>
                </div>
            </div>
        </div>

        <!-- Filter Bar -->
        <div class="sticky top-16 z-30 bg-white/95 backdrop-blur border-b border-gray-100 py-3 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 flex items-center justify-between gap-4">
                <div id="sub-category-container" class="flex space-x-3 overflow-x-auto hide-scroll pb-1 flex-1"></div>
                <div class="flex items-center gap-2">
                    <div class="relative">
                        <button onclick="toggleSortDropdown()" class="px-4 py-2 rounded-lg border border-gray-200 text-sm font-medium bg-white hover:bg-gray-50 transition outline-none cursor-pointer flex items-center gap-2">
                            <span id="sort-label">Sort by</span>
                            <i class="fa-solid fa-chevron-down text-xs"></i>
                        </button>
                        <div id="sort-dropdown" class="hidden absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-xl border border-gray-100 py-2 z-50">
                            <button onclick="selectSort('', 'Sort by')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition">
                                Default
                            </button>
                            <button onclick="selectSort('asc', 'Price: Low to High')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition">
                                Price: Low to High
                            </button>
                            <button onclick="selectSort('desc', 'Price: High to Low')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition">
                                Price: High to Low
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grid -->
        <main class="max-w-7xl mx-auto px-4 py-8">
            <div class="mb-6">
                <h2 id="section-title" class="text-2xl font-bold text-slate-900">Trending Products</h2>
                <p class="text-slate-500 text-sm mt-1">Highly rated rentals near you</p>
            </div>
            <div id="listings-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
        </main>
    </div>

    <!-- Product Details - Complete Professional Page -->
    <div id="product-details-view" class="hidden bg-white min-h-screen animate-fade-in">
        <!-- Header -->
        <div class="border-b border-gray-200 bg-white sticky top-0 z-30">
            <div class="max-w-7xl mx-auto px-6 lg:px-8 py-4">
                <button onclick="goHome()" class="inline-flex items-center gap-2 text-sm font-semibold text-gray-700 hover:text-slate-900 transition">
                    <i class="fa-solid fa-chevron-left"></i> Back
                </button>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-6 lg:px-8 py-8">
            <!-- Title & Actions -->
            <div class="mb-6">
                <h1 id="detail-title" class="text-3xl font-bold text-slate-900 mb-3"></h1>
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-4 text-sm">
                        <div class="flex items-center gap-1">
                            <i class="fa-solid fa-star text-sm"></i>
                            <span id="detail-rating" class="font-semibold"></span>
                            <span class="text-gray-500">(128 reviews)</span>
                        </div>
                        <span class="text-gray-300">•</span>
                        <div class="flex items-center gap-1.5">
                            <i class="fa-solid fa-location-dot text-sm"></i>
                            <span id="detail-location">India</span>
                            <span>-</span>
                            <span id="detail-pincode" class="font-semibold"></span>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="shareItem()" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-50 rounded-lg transition text-sm font-semibold">
                            <i class="fa-solid fa-share-nodes"></i> Share
                        </button>
                        <button id="wishlist-btn" onclick="toggleWishlistItem()" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-50 rounded-lg transition text-sm font-semibold">
                            <i class="fa-regular fa-heart"></i> Save
                        </button>
                    </div>
                </div>
            </div>

            <!-- Image Gallery -->
            <div class="grid grid-cols-4 gap-2 rounded-2xl overflow-hidden mb-12 h-[500px]">
                <div class="col-span-2 row-span-2 relative group cursor-pointer" onclick="openImageGallery(0)">
                    <img id="detail-img-main" src="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition"></div>
                </div>
                <div class="relative group cursor-pointer" onclick="openImageGallery(1)">
                    <img id="detail-img-1" src="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition"></div>
                </div>
                <div class="relative group cursor-pointer" onclick="openImageGallery(2)">
                    <img id="detail-img-2" src="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition"></div>
                </div>
                <div class="relative group cursor-pointer" onclick="openImageGallery(3)">
                    <img id="detail-img-3" src="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition"></div>
                </div>
                <div class="relative group cursor-pointer" onclick="openImageGallery(4)">
                    <img id="detail-img-4" src="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition"></div>
                    <button onclick="event.stopPropagation(); openImageGallery(0)" class="absolute bottom-4 right-4 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-semibold hover:bg-gray-50 transition flex items-center gap-2">
                        <i class="fa-solid fa-grid"></i> Show all photos
                    </button>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                <!-- Left Content -->
                <div class="lg:col-span-2 space-y-8">
                    <!-- Host Info -->
                    <div class="pb-8 border-b border-gray-200">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-4">
                                <div class="relative">
                                    <img id="detail-host-avatar" src="" class="w-16 h-16 rounded-full border-2 border-gray-200">
                                    <div id="detail-host-verified" class="hidden absolute -bottom-1 -right-1 w-6 h-6 bg-emerald-500 border-2 border-white rounded-full flex items-center justify-center">
                                        <i class="fa-solid fa-check text-white text-xs"></i>
                                    </div>
                                </div>
                                <div>
                                    <p class="font-bold text-lg text-slate-900">Hosted by <span id="detail-host-name"></span></p>
                                    <p class="text-sm text-gray-500">Joined in 2024</p>
                                </div>
                            </div>
                            <button onclick="contactHost()" class="px-6 py-3 border-2 border-slate-900 text-slate-900 font-semibold rounded-xl hover:bg-slate-50 transition">
                                Contact Host
                            </button>
                        </div>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="flex items-center gap-3">
                                <i class="fa-solid fa-star text-xl"></i>
                                <div>
                                    <p class="font-semibold text-slate-900">14 Reviews</p>
                                    <p class="text-xs text-gray-500">Verified reviews</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <i class="fa-solid fa-shield-check text-xl"></i>
                                <div>
                                    <p class="font-semibold text-slate-900">Identity verified</p>
                                    <p class="text-xs text-gray-500">Confirmed</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <i class="fa-solid fa-medal text-xl"></i>
                                <div>
                                    <p class="font-semibold text-slate-900">Superhost</p>
                                    <p class="text-xs text-gray-500">Top rated</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="pb-8 border-b border-gray-200">
                        <h2 class="text-2xl font-bold text-slate-900 mb-4">About this listing</h2>
                        <p id="detail-description" class="text-gray-700 leading-relaxed text-base"></p>
                    </div>

                    <!-- What's Included -->
                    <div class="pb-8 border-b border-gray-200">
                        <h2 id="features-title" class="text-2xl font-bold text-slate-900 mb-6">What's included</h2>
                        <div id="features-grid" class="grid grid-cols-2 gap-4">
                            <!-- Will be populated dynamically based on category -->
                        </div>
                    </div>

                    <!-- Reviews Section -->
                    <div class="pb-8">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-slate-900">
                                <i class="fa-solid fa-star mr-2"></i>
                                <span id="detail-rating-2"></span> · <span id="review-count">0</span> reviews
                            </h2>
                            <button onclick="openReviewModal()" class="px-6 py-3 bg-primary text-white font-semibold rounded-xl hover:bg-primaryDark transition">
                                <i class="fa-solid fa-pen mr-2"></i> Write a Review
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-6 mb-8">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Quality</span>
                                <div class="flex items-center gap-2">
                                    <div class="w-32 h-1 bg-gray-200 rounded-full overflow-hidden">
                                        <div class="h-full bg-slate-900" style="width: 96%"></div>
                                    </div>
                                    <span class="font-semibold text-sm">4.8</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Accuracy</span>
                                <div class="flex items-center gap-2">
                                    <div class="w-32 h-1 bg-gray-200 rounded-full overflow-hidden">
                                        <div class="h-full bg-slate-900" style="width: 100%"></div>
                                    </div>
                                    <span class="font-semibold text-sm">5.0</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Communication</span>
                                <div class="flex items-center gap-2">
                                    <div class="w-32 h-1 bg-gray-200 rounded-full overflow-hidden">
                                        <div class="h-full bg-slate-900" style="width: 94%"></div>
                                    </div>
                                    <span class="font-semibold text-sm">4.7</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Value</span>
                                <div class="flex items-center gap-2">
                                    <div class="w-32 h-1 bg-gray-200 rounded-full overflow-hidden">
                                        <div class="h-full bg-slate-900" style="width: 98%"></div>
                                    </div>
                                    <span class="font-semibold text-sm">4.9</span>
                                </div>
                            </div>
                        </div>
                        <!-- Reviews List -->
                        <div id="reviews-list" class="space-y-6">
                            <!-- Will be populated dynamically -->
                        </div>
                        <button onclick="showAllReviews()" id="show-all-reviews-btn" class="hidden mt-6 px-6 py-3 border-2 border-slate-900 text-slate-900 font-semibold rounded-xl hover:bg-slate-50 transition">
                            Show all reviews
                        </button>
                    </div>
                </div>

                <!-- Right Sidebar - Booking Card -->
                <div class="lg:col-span-1">
                    <div class="sticky top-24">
                        <div class="border-2 border-gray-200 rounded-2xl p-6 shadow-xl">
                            <div class="flex items-baseline gap-2 mb-6">
                                <span id="detail-price" class="text-3xl font-bold text-slate-900"></span>
                                <span id="detail-unit" class="text-gray-500 font-medium"></span>
                            </div>
                            
                            <div class="space-y-3 mb-6">
                                <div class="border-2 border-gray-300 rounded-xl p-4">
                                    <label class="text-xs font-semibold text-gray-700 uppercase">Start Date</label>
                                    <input type="date" id="detail-start-date" class="w-full mt-1 text-sm font-semibold outline-none">
                                </div>
                                <div class="border-2 border-gray-300 rounded-xl p-4">
                                    <label class="text-xs font-semibold text-gray-700 uppercase">End Date</label>
                                    <input type="date" id="detail-end-date" class="w-full mt-1 text-sm font-semibold outline-none">
                                </div>
                            </div>

                            <button onclick="handleRentNow()" class="w-full bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white font-bold py-4 rounded-xl transition shadow-lg mb-4">
                                Reserve
                            </button>
                            <p class="text-center text-sm text-gray-500 mb-6">You won't be charged yet</p>

                            <div class="space-y-3 py-4 border-t border-gray-200">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-700 underline" id="detail-price-breakdown">Select dates</span>
                                    <span class="font-semibold" id="detail-rental-amount">₹0</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-700 underline">Service fee</span>
                                    <span class="font-semibold">₹60</span>
                                </div>
                                <div class="flex justify-between pt-3 border-t border-gray-200 font-bold">
                                    <span>Total</span>
                                    <span id="detail-total-amount">₹60</span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 p-4 bg-gray-50 rounded-xl border border-gray-200">
                            <div class="flex items-start gap-3">
                                <i class="fa-solid fa-shield-check text-2xl text-emerald-600 mt-1"></i>
                                <div>
                                    <p class="font-semibold text-slate-900 mb-1">Secure booking</p>
                                    <p class="text-sm text-gray-600">Your payment information is protected with industry-standard encryption</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CART SIDEBAR -->
    <div id="cart-sidebar" class="fixed inset-y-0 right-0 w-full sm:w-96 bg-white shadow-2xl z-[60] transform translate-x-full transition-transform duration-300 flex flex-col">
        <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50">
            <h2 class="font-bold text-lg text-slate-900"><i class="fa-solid fa-bag-shopping mr-2"></i>Your Cart</h2>
            <button onclick="toggleCart()" class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-gray-500 hover:text-black shadow-sm"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-5 space-y-4">
            <div id="cart-empty" class="flex flex-col items-center justify-center h-64 text-center text-gray-400">
                <i class="fa-solid fa-basket-shopping text-4xl mb-3 opacity-20"></i>
                <p>Your cart is empty</p>
            </div>
        </div>
        <div class="p-5 border-t border-gray-100 bg-white">
            <div class="flex justify-between font-bold text-lg mb-4 text-slate-900"><span>Total</span><span id="cart-total">₹0</span></div>
            <button onclick="handleCheckout()" class="w-full bg-primary hover:bg-primaryDark text-white font-bold py-3.5 rounded-xl transition shadow-lg shadow-primary/30">Checkout</button>
        </div>
    </div>
    <div id="cart-overlay" onclick="toggleCart()" class="fixed inset-0 bg-slate-900/20 z-[55] hidden backdrop-blur-sm transition-opacity"></div>

    <!-- WISHLIST SIDEBAR -->
    <div id="wishlist-sidebar" class="fixed inset-y-0 right-0 w-full sm:w-96 bg-white shadow-2xl z-[60] transform translate-x-full transition-transform duration-300 flex flex-col">
        <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50">
            <h2 class="font-bold text-lg text-slate-900"><i class="fa-regular fa-heart mr-2 text-red-500"></i>Your Wishlist</h2>
            <button onclick="toggleWishlist()" class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-gray-500 hover:text-black shadow-sm"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="wishlist-items" class="flex-1 overflow-y-auto p-5 space-y-4">
            <div id="wishlist-empty" class="flex flex-col items-center justify-center h-64 text-center text-gray-400">
                <i class="fa-regular fa-heart text-4xl mb-3 opacity-20"></i>
                <p>Your wishlist is empty</p>
            </div>
        </div>
        <div class="p-5 border-t border-gray-100 bg-white">
            <button onclick="addAllToCart()" class="w-full bg-primary hover:bg-primaryDark text-white font-bold py-3.5 rounded-xl transition shadow-lg shadow-primary/30">Add All to Cart</button>
        </div>
    </div>
    <div id="wishlist-overlay" onclick="toggleWishlist()" class="fixed inset-0 bg-slate-900/20 z-[55] hidden backdrop-blur-sm transition-opacity"></div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed bottom-5 right-5 bg-slate-900 text-white px-6 py-3 rounded-lg shadow-2xl transform translate-y-20 opacity-0 transition-all duration-300 z-[120] flex items-center gap-3 font-medium">
        <i class="fa-solid fa-circle-check text-green-400"></i> <span id="toast-msg">Success</span>
    </div>

    <!-- REVIEW MODAL -->
    <div id="review-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div onclick="closeReviewModal()" class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm"></div>
        <div class="relative bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 animate-fade-in">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-slate-900">Write a Review</h3>
                <button onclick="closeReviewModal()" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 transition">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            
            <form onsubmit="submitReview(event)" class="space-y-4">
                <!-- Rating -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Rating</label>
                    <div class="flex gap-2">
                        <button type="button" onclick="setRating(1)" class="rating-star text-3xl text-gray-300 hover:text-yellow-500 transition">
                            <i class="fa-solid fa-star"></i>
                        </button>
                        <button type="button" onclick="setRating(2)" class="rating-star text-3xl text-gray-300 hover:text-yellow-500 transition">
                            <i class="fa-solid fa-star"></i>
                        </button>
                        <button type="button" onclick="setRating(3)" class="rating-star text-3xl text-gray-300 hover:text-yellow-500 transition">
                            <i class="fa-solid fa-star"></i>
                        </button>
                        <button type="button" onclick="setRating(4)" class="rating-star text-3xl text-gray-300 hover:text-yellow-500 transition">
                            <i class="fa-solid fa-star"></i>
                        </button>
                        <button type="button" onclick="setRating(5)" class="rating-star text-3xl text-gray-300 hover:text-yellow-500 transition">
                            <i class="fa-solid fa-star"></i>
                        </button>
                    </div>
                    <input type="hidden" id="review-rating" required>
                </div>

                <!-- Comment -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Your Review</label>
                    <textarea id="review-comment" rows="4" required class="w-full border border-gray-200 rounded-lg px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-primary" placeholder="Share your experience..."></textarea>
                </div>

                <!-- Submit -->
                <div class="flex gap-3">
                    <button type="button" onclick="closeReviewModal()" class="flex-1 px-6 py-3 border-2 border-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 px-6 py-3 bg-primary text-white font-semibold rounded-xl hover:bg-primaryDark transition">
                        Submit Review
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all relative">
            <!-- Close Button -->
            <button onclick="closeAuthModal()" class="absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 transition z-10">
                <i class="fa-solid fa-xmark"></i>
            </button>

            <!-- Login Form -->
            <div id="login-form" class="p-8">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-indigo-50 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-user text-3xl text-primary"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-900">Welcome Back</h2>
                    <p class="text-gray-500 text-sm mt-2">Login to continue your rental journey</p>
                </div>

                <!-- Google Sign In -->
                <button onclick="handleGoogleLogin()" class="w-full border-2 border-gray-200 bg-white rounded-xl py-3.5 flex items-center justify-center hover:bg-gray-50 transition gap-3 font-bold text-slate-700 mb-4 shadow-sm">
                    <i class="fa-brands fa-google text-red-500 text-xl"></i> 
                    <span>Continue with Google</span>
                </button>

                <div class="relative my-6">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-200"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-4 bg-white text-gray-500">Or continue with email</span>
                    </div>
                </div>

                <!-- Email Login Form -->
                <form onsubmit="handleEmailLogin(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Email</label>
                        <input type="email" id="login-email" required placeholder="your@email.com" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Password</label>
                        <div class="relative">
                            <input type="password" id="login-password" required placeholder="••••••••" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition">
                            <button type="button" onclick="togglePassword('login-password')" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <i class="fa-regular fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary">
                            <span class="text-gray-600">Remember me</span>
                        </label>
                        <a href="#" class="text-primary hover:text-primaryDark font-medium">Forgot password?</a>
                    </div>
                    <button type="submit" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3.5 rounded-xl transition shadow-lg">
                        Sign In
                    </button>
                </form>

                <p class="text-center text-sm text-gray-600 mt-6">
                    Don't have an account? 
                    <button onclick="switchToSignup()" class="text-primary hover:text-primaryDark font-bold">Sign Up</button>
                </p>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="p-8 hidden">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-indigo-50 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-user-plus text-3xl text-primary"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-900">Create Account</h2>
                    <p class="text-gray-500 text-sm mt-2">Join RentIt and start renting today</p>
                </div>

                <!-- Google Sign Up -->
                <button onclick="handleGoogleLogin()" class="w-full border-2 border-gray-200 bg-white rounded-xl py-3.5 flex items-center justify-center hover:bg-gray-50 transition gap-3 font-bold text-slate-700 mb-4 shadow-sm">
                    <i class="fa-brands fa-google text-red-500 text-xl"></i> 
                    <span>Sign up with Google</span>
                </button>

                <div class="relative my-6">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-200"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-4 bg-white text-gray-500">Or sign up with email</span>
                    </div>
                </div>

                <!-- Email Signup Form -->
                <form onsubmit="handleEmailSignup(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Full Name</label>
                        <input type="text" id="signup-name" required placeholder="John Doe" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Email</label>
                        <input type="email" id="signup-email" required placeholder="your@email.com" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Password</label>
                        <div class="relative">
                            <input type="password" id="signup-password" required placeholder="••••••••" minlength="6" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition">
                            <button type="button" onclick="togglePassword('signup-password')" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <i class="fa-regular fa-eye"></i>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Minimum 6 characters</p>
                    </div>
                    <div>
                        <label class="flex items-start gap-2 cursor-pointer text-sm">
                            <input type="checkbox" required class="w-4 h-4 mt-0.5 rounded border-gray-300 text-primary focus:ring-primary">
                            <span class="text-gray-600">I agree to the <a href="/policies#terms" class="text-primary hover:underline">Terms of Service</a> and <a href="/policies#privacy" class="text-primary hover:underline">Privacy Policy</a></span>
                        </label>
                    </div>
                    <button type="submit" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3.5 rounded-xl transition shadow-lg">
                        Create Account
                    </button>
                </form>

                <p class="text-center text-sm text-gray-600 mt-6">
                    Already have an account? 
                    <button onclick="switchToLogin()" class="text-primary hover:text-primaryDark font-bold">Sign In</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Location Modal -->
    <div id="location-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-md z-[110] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-fade-in text-center p-8">
            <div class="w-16 h-16 bg-indigo-50 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce-slow"><i class="fa-solid fa-location-dot text-3xl text-primary"></i></div>
            <h2 class="text-2xl font-bold text-slate-900 mb-2">Enable Location</h2>
            <p class="text-gray-500 text-sm mb-6">See what's available near you.</p>
            <button onclick="detectLocation()" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3.5 rounded-xl transition shadow-lg mb-3">Use Current Location</button>
            <button onclick="document.getElementById('location-modal').classList.add('hidden')" class="w-full border border-gray-200 text-slate-600 font-bold py-3.5 rounded-xl hover:bg-gray-50 transition">Enter Manually</button>
        </div>
    </div>

    <!-- Image Gallery Modal -->
    <div id="image-gallery-modal" class="fixed inset-0 bg-black z-[120] hidden">
        <button onclick="closeImageGallery()" class="absolute top-4 right-4 w-12 h-12 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition z-10">
            <i class="fa-solid fa-xmark text-xl"></i>
        </button>
        <div class="absolute top-4 left-4 text-white font-semibold z-10">
            <span id="gallery-counter">1 / 5</span>
        </div>
        <div class="h-full flex items-center justify-center p-4">
            <button onclick="prevImage()" class="absolute left-4 w-12 h-12 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition">
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            <img id="gallery-image" src="" class="max-w-full max-h-full object-contain">
            <button onclick="nextImage()" class="absolute right-4 w-12 h-12 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition">
                <i class="fa-solid fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- Contact Host Modal -->
    <div id="contact-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[110] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-fade-in">
            <div class="p-6 border-b border-gray-100">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-slate-900">Contact Host</h3>
                    <button onclick="closeContactModal()" class="w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center transition">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="flex items-center gap-4 mb-6 p-4 bg-gray-50 rounded-xl">
                    <img id="contact-host-avatar" src="" class="w-12 h-12 rounded-full">
                    <div>
                        <p class="font-bold text-slate-900" id="contact-host-name"></p>
                        <p class="text-sm text-gray-500">Typically responds within an hour</p>
                    </div>
                </div>
                <form onsubmit="sendMessage(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Your Message</label>
                        <textarea id="contact-message" required rows="4" placeholder="Hi! I'm interested in renting this item..." class="w-full border-2 border-gray-200 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-primary resize-none"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3.5 rounded-xl transition">
                        Send Message
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- All Reviews Modal -->
    <div id="reviews-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[110] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden animate-fade-in flex flex-col">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between">
                <div>
                    <h3 class="text-2xl font-bold text-slate-900 flex items-center gap-2">
                        <i class="fa-solid fa-star text-yellow-500"></i>
                        <span id="reviews-rating">4.9</span> · 128 reviews
                    </h3>
                </div>
                <button onclick="closeReviewsModal()" class="w-10 h-10 rounded-full hover:bg-gray-100 flex items-center justify-center transition">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            
            <!-- Rating Breakdown -->
            <div class="p-6 border-b border-gray-100 bg-gray-50">
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-700">Cleanliness</span>
                        <div class="flex items-center gap-2">
                            <div class="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-slate-900" style="width: 96%"></div>
                            </div>
                            <span class="font-bold text-sm">4.8</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-700">Accuracy</span>
                        <div class="flex items-center gap-2">
                            <div class="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-slate-900" style="width: 100%"></div>
                            </div>
                            <span class="font-bold text-sm">5.0</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-700">Communication</span>
                        <div class="flex items-center gap-2">
                            <div class="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-slate-900" style="width: 94%"></div>
                            </div>
                            <span class="font-bold text-sm">4.7</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-700">Value</span>
                        <div class="flex items-center gap-2">
                            <div class="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-slate-900" style="width: 98%"></div>
                            </div>
                            <span class="font-bold text-sm">4.9</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Reviews List -->
            <div class="flex-1 overflow-y-auto p-6">
                <div class="space-y-6" id="all-reviews-container">
                    <!-- Reviews will be loaded here -->
                    <div class="flex gap-4 pb-6 border-b border-gray-100">
                        <img src="https://ui-avatars.com/api/?name=John+Doe&background=random" class="w-12 h-12 rounded-full flex-shrink-0">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <div>
                                    <p class="font-bold text-slate-900">John Doe</p>
                                    <p class="text-sm text-gray-500">March 2024</p>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i class="fa-solid fa-star text-yellow-500 text-sm"></i>
                                    <span class="font-bold text-sm">5.0</span>
                                </div>
                            </div>
                            <p class="text-gray-700 leading-relaxed">Great experience! The item was exactly as described and in perfect condition. The host was very responsive and made the pickup process smooth. Highly recommend!</p>
                        </div>
                    </div>
                    
                    <div class="flex gap-4 pb-6 border-b border-gray-100">
                        <img src="https://ui-avatars.com/api/?name=Sarah+Smith&background=random" class="w-12 h-12 rounded-full flex-shrink-0">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <div>
                                    <p class="font-bold text-slate-900">Sarah Smith</p>
                                    <p class="text-sm text-gray-500">February 2024</p>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i class="fa-solid fa-star text-yellow-500 text-sm"></i>
                                    <span class="font-bold text-sm">4.8</span>
                                </div>
                            </div>
                            <p class="text-gray-700 leading-relaxed">Excellent service and quality. The host was very responsive and helpful throughout the rental period. Would definitely rent again!</p>
                        </div>
                    </div>
                    
                    <div class="flex gap-4 pb-6 border-b border-gray-100">
                        <img src="https://ui-avatars.com/api/?name=Mike+Johnson&background=random" class="w-12 h-12 rounded-full flex-shrink-0">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <div>
                                    <p class="font-bold text-slate-900">Mike Johnson</p>
                                    <p class="text-sm text-gray-500">January 2024</p>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i class="fa-solid fa-star text-yellow-500 text-sm"></i>
                                    <span class="font-bold text-sm">5.0</span>
                                </div>
                            </div>
                            <p class="text-gray-700 leading-relaxed">Perfect rental experience! Everything was clean, well-maintained, and ready to use. Communication was excellent and pickup/return was hassle-free.</p>
                        </div>
                    </div>
                    
                    <div class="flex gap-4 pb-6 border-b border-gray-100">
                        <img src="https://ui-avatars.com/api/?name=Emily+Davis&background=random" class="w-12 h-12 rounded-full flex-shrink-0">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <div>
                                    <p class="font-bold text-slate-900">Emily Davis</p>
                                    <p class="text-sm text-gray-500">December 2023</p>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i class="fa-solid fa-star text-yellow-500 text-sm"></i>
                                    <span class="font-bold text-sm">4.9</span>
                                </div>
                            </div>
                            <p class="text-gray-700 leading-relaxed">Amazing quality and great value for money. The item exceeded my expectations. Host was professional and accommodating with timing.</p>
                        </div>
                    </div>
                    
                    <div class="flex gap-4">
                        <img src="https://ui-avatars.com/api/?name=Alex+Brown&background=random" class="w-12 h-12 rounded-full flex-shrink-0">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <div>
                                    <p class="font-bold text-slate-900">Alex Brown</p>
                                    <p class="text-sm text-gray-500">November 2023</p>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i class="fa-solid fa-star text-yellow-500 text-sm"></i>
                                    <span class="font-bold text-sm">5.0</span>
                                </div>
                            </div>
                            <p class="text-gray-700 leading-relaxed">Highly recommended! The rental process was seamless from start to finish. Item was in pristine condition and exactly what I needed for my project.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global State
        const subCategories = {
            products: [{name:'All'}, {name:'Cameras'}, {name:'Electronics'}, {name:'Vehicles'}, {name:'Furniture'}, {name:'Sports'}, {name:'Music'}, {name:'Fashion'}, {name:'Tools'}],
            services: [{name:'All'}, {name:'Tech'}, {name:'Home'}, {name:'Personal'}, {name:'Events'}],
            spaces: [{name:'All'}, {name:'Vacation'}, {name:'Apartments'}, {name:'Offices'}, {name:'Halls'}, {name:'Studios'}]
        };

        let cart = [];
        let wishlist = [];
        let currentItem = null;
        let currentCategory = 'products';
        let currentListings = [];

        window.onload = function() {
            switchMainTab('products');
        }

        // Fetch listings from backend API
        async function fetchListings(category, sortOrder = null) {
            try {
                let url = `/api/listings?category=${category}`;
                if (sortOrder) {
                    url += `&sort=${sortOrder}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching listings:', error);
                showToast('Error loading listings');
                return [];
            }
        }

        // Switch main category tab
        async function switchMainTab(cat) {
            currentCategory = cat;
            
            // Update tab styling
            document.querySelectorAll('#tab-products, #tab-services, #tab-spaces').forEach(el => 
                el.className = "px-6 py-2 rounded-lg text-sm font-semibold text-gray-500 hover:text-gray-900 transition-all flex items-center gap-2"
            );
            document.getElementById(`tab-${cat}`).className = "px-6 py-2 rounded-lg text-sm font-semibold bg-white text-primary shadow-sm transition-all flex items-center gap-2";
            
            // Update subcategories
            document.getElementById('sub-category-container').innerHTML = subCategories[cat].map((i, idx) => 
                `<button onclick="filterBySubcategory('${i.name}')" class="category-chip px-5 py-2 rounded-full text-sm font-medium border border-gray-200 whitespace-nowrap ${idx===0?'active':''} hover:bg-gray-50 transition">${i.name}</button>`
            ).join('');
            
            // Show loading state
            document.getElementById('listings-grid').innerHTML = '<div class="col-span-full text-center py-12"><i class="fa-solid fa-spinner fa-spin text-3xl text-primary"></i><p class="mt-4 text-gray-500">Loading...</p></div>';
            
            // Fetch and display listings
            currentListings = await fetchListings(cat);
            renderListings(currentListings);
            goHome();
        }

        // Render listings grid
        function renderListings(items) {
            const grid = document.getElementById('listings-grid');
            
            if (items.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center py-12"><i class="fa-solid fa-box-open text-4xl text-gray-300 mb-4"></i><p class="text-gray-500">No listings found</p></div>';
                return;
            }
            
            grid.innerHTML = items.map((item, idx) => `
                <div class="group bg-white rounded-2xl p-3 shadow-card hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer relative">
                    <div onclick='openDetails(${JSON.stringify(item).replace(/'/g, "&apos;")})'>
                        <div class="relative rounded-xl h-48 mb-3 overflow-hidden">
                            <img src="${item.img}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500" alt="${item.title}">
                            ${item.tag ? `<span class="absolute top-2 left-2 bg-slate-900/80 backdrop-blur-sm text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">${item.tag}</span>` : ''}
                            ${item.distance !== undefined ? `<span class="absolute top-2 right-2 bg-primary/90 backdrop-blur-sm text-white text-[10px] font-bold px-2 py-1 rounded flex items-center gap-1"><i class="fa-solid fa-location-dot"></i>${item.distance} km</span>` : ''}
                        </div>
                        <div class="px-1">
                            <h3 class="font-bold text-slate-900 text-lg leading-tight truncate">${item.title}</h3>
                            ${item.pincode ? `<p class="text-xs text-gray-500 mt-1"><i class="fa-solid fa-map-pin text-primary"></i> ${item.pincode}</p>` : ''}
                            <div class="flex justify-between mt-2 pt-2 border-t border-gray-100">
                                <span class="font-bold text-slate-900">${item.price}</span>
                                <span class="text-primary text-sm font-bold group-hover:underline">Details <i class="fa-solid fa-arrow-right text-xs"></i></span>
                            </div>
                        </div>
                    </div>
                    <button onclick='quickAddToWishlist(${JSON.stringify(item).replace(/'/g, "&apos;")}, event)' class="absolute top-5 right-5 w-8 h-8 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center text-gray-600 hover:text-red-500 hover:bg-white shadow-md transition opacity-0 group-hover:opacity-100">
                        <i class="fa-regular fa-heart text-sm"></i>
                    </button>
                </div>
            `).join('');
        }

        // Open product details
        function openDetails(item) {
            currentItem = item;
            
            // Populate images - use multiple if available, otherwise same image
            if (item.images && item.images.length > 0) {
                // Use uploaded images
                document.getElementById('detail-img-main').src = item.images[0];
                for (let i = 1; i <= 4; i++) {
                    const imgEl = document.getElementById(`detail-img-${i}`);
                    if (imgEl) {
                        imgEl.src = item.images[i] || item.images[0]; // Fallback to first image
                    }
                }
            } else {
                // Fallback: use single image for all
                document.getElementById('detail-img-main').src = item.img;
                document.getElementById('detail-img-1').src = item.img;
                document.getElementById('detail-img-2').src = item.img;
                document.getElementById('detail-img-3').src = item.img;
                document.getElementById('detail-img-4').src = item.img;
            }
            
            // Basic info
            document.getElementById('detail-title').innerText = item.title;
            document.getElementById('detail-rating').innerText = item.rating;
            document.getElementById('detail-rating-2').innerText = item.rating;
            document.getElementById('detail-price').innerText = item.price;
            document.getElementById('detail-unit').innerText = item.unit;
            
            // Location & Pincode
            if (item.pincode) {
                document.getElementById('detail-pincode').innerText = item.pincode;
                document.getElementById('detail-location').innerText = 'India';
            }
            
            // Description
            if (item.description) {
                document.getElementById('detail-description').innerText = item.description;
            } else {
                document.getElementById('detail-description').innerText = 'No description available.';
            }
            
            // Host Info
            if (item.hostName) {
                document.getElementById('detail-host-name').innerText = item.hostName;
                const hostAvatar = document.getElementById('detail-host-avatar');
                hostAvatar.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(item.hostName)}&background=4f46e5&color=fff`;
                
                // Show verified badge if host is verified
                const hostVerifiedBadge = document.getElementById('detail-host-verified');
                if (item.hostVerified) {
                    hostVerifiedBadge.classList.remove('hidden');
                } else {
                    hostVerifiedBadge.classList.add('hidden');
                }
            }

            // Initialize date pickers with min date as today
            const today = new Date().toISOString().split('T')[0];
            const detailStartDate = document.getElementById('detail-start-date');
            const detailEndDate = document.getElementById('detail-end-date');
            
            if (detailStartDate && detailEndDate) {
                detailStartDate.min = today;
                detailEndDate.min = today;
                detailStartDate.value = ''; // Clear previous values
                detailEndDate.value = '';
                
                // Reset price breakdown
                document.getElementById('detail-price-breakdown').innerText = 'Select dates';
                document.getElementById('detail-rental-amount').innerText = '₹0';
                document.getElementById('detail-total-amount').innerText = '₹60';
                
                // Update end date min when start date changes
                detailStartDate.addEventListener('change', function() {
                    if (this.value) {
                        detailEndDate.min = this.value;
                        // Clear end date if it's before new start date
                        if (detailEndDate.value && detailEndDate.value < this.value) {
                            detailEndDate.value = '';
                        }
                    }
                    calculateDetailPrice();
                });
                
                detailEndDate.addEventListener('change', function() {
                    calculateDetailPrice();
                });
            }

            // Category-specific features
            populateCategoryFeatures(currentCategory);

            // Load reviews for this item
            loadReviews();

            // Update wishlist button state
            const btn = document.getElementById('wishlist-btn');
            const icon = btn.querySelector('i');
            const isInWishlist = wishlist.some(w => w.title === item.title);
            
            if(isInWishlist) {
                icon.classList.remove('fa-regular');
                icon.classList.add('fa-solid', 'text-red-500');
            } else {
                icon.classList.remove('fa-solid', 'text-red-500');
                icon.classList.add('fa-regular');
            }

            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('product-details-view').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        // Populate category-specific features
        function populateCategoryFeatures(category) {
            const featuresGrid = document.getElementById('features-grid');
            const featuresTitle = document.getElementById('features-title');
            
            let features = [];
            
            if (category === 'products') {
                featuresTitle.innerText = "What's included";
                features = [
                    { icon: 'fa-box-open', text: 'Excellent condition' },
                    { icon: 'fa-check-circle', text: 'Ready to use' },
                    { icon: 'fa-truck', text: 'Delivery available' },
                    { icon: 'fa-shield-check', text: 'Damage protection' },
                    { icon: 'fa-clock', text: 'Flexible pickup' },
                    { icon: 'fa-headset', text: '24/7 support' }
                ];
            } else if (category === 'services') {
                featuresTitle.innerText = "Service includes";
                features = [
                    { icon: 'fa-user-check', text: 'Verified professional' },
                    { icon: 'fa-certificate', text: 'Certified & experienced' },
                    { icon: 'fa-calendar-check', text: 'Flexible scheduling' },
                    { icon: 'fa-comments', text: 'Direct communication' },
                    { icon: 'fa-star', text: 'Highly rated' },
                    { icon: 'fa-shield-halved', text: 'Satisfaction guaranteed' }
                ];
            } else if (category === 'spaces') {
                featuresTitle.innerText = "Amenities";
                features = [
                    { icon: 'fa-wifi', text: 'Free WiFi' },
                    { icon: 'fa-parking', text: 'Parking available' },
                    { icon: 'fa-snowflake', text: 'Air conditioning' },
                    { icon: 'fa-utensils', text: 'Kitchen facilities' },
                    { icon: 'fa-tv', text: 'Entertainment' },
                    { icon: 'fa-lock', text: 'Secure access' }
                ];
            }
            
            featuresGrid.innerHTML = features.map(f => `
                <div class="flex items-center gap-3">
                    <i class="fa-solid ${f.icon} text-emerald-600 text-xl"></i>
                    <span class="text-gray-700">${f.text}</span>
                </div>
            `).join('');
        }

        // Go back to home view
        function goHome() {
            document.getElementById('product-details-view').classList.add('hidden');
            document.getElementById('home-view').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        // Cart Management
        function toggleCart() {
            const sb = document.getElementById('cart-sidebar');
            const ov = document.getElementById('cart-overlay');
            if(sb.classList.contains('translate-x-full')) { 
                sb.classList.remove('translate-x-full'); 
                ov.classList.remove('hidden'); 
            } else { 
                sb.classList.add('translate-x-full'); 
                ov.classList.add('hidden'); 
            }
        }

        function addToCart() {
            if(!currentItem) return;
            cart.push(currentItem);
            updateCart();
            toggleCart();
            showToast("Item added to cart!");
        }

        function updateCart() {
            const badge = document.getElementById('cart-count');
            const container = document.getElementById('cart-items');
            
            if(cart.length === 0) {
                badge.classList.add('hidden');
                container.innerHTML = `<div class="flex flex-col items-center justify-center h-full text-center text-gray-400"><i class="fa-solid fa-basket-shopping text-4xl mb-3 opacity-20"></i><p>Your cart is empty</p></div>`;
            } else {
                badge.innerText = cart.length;
                badge.classList.remove('hidden');
                container.innerHTML = cart.map((i, idx) => `
                    <div class="flex gap-3 bg-gray-50 p-2 rounded-lg items-center animate-fade-in">
                        <img src="${i.img}" class="w-14 h-14 rounded-md object-cover" alt="${i.title}">
                        <div class="flex-1">
                            <p class="font-bold text-sm text-slate-900">${i.title}</p>
                            <p class="text-xs text-gray-500">${i.price}</p>
                        </div>
                        <button onclick="removeFromCart(${idx})" class="text-gray-400 hover:text-red-500 p-2">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }
        }

        function removeFromCart(idx) {
            cart.splice(idx, 1);
            updateCart();
            showToast("Item removed from cart");
        }

        // Wishlist Management
        function toggleWishlist() {
            const sb = document.getElementById('wishlist-sidebar');
            const ov = document.getElementById('wishlist-overlay');
            if(sb.classList.contains('translate-x-full')) { 
                sb.classList.remove('translate-x-full'); 
                ov.classList.remove('hidden'); 
            } else { 
                sb.classList.add('translate-x-full'); 
                ov.classList.add('hidden'); 
            }
        }

        function toggleWishlistItem() {
            if(!currentItem) return;
            
            const index = wishlist.findIndex(item => item.title === currentItem.title);
            const btn = document.getElementById('wishlist-btn');
            const icon = btn.querySelector('i');
            
            if(index > -1) {
                // Remove from wishlist
                wishlist.splice(index, 1);
                icon.classList.remove('fa-solid', 'text-red-500');
                icon.classList.add('fa-regular');
                showToast("Removed from wishlist");
            } else {
                // Add to wishlist
                wishlist.push(currentItem);
                icon.classList.remove('fa-regular');
                icon.classList.add('fa-solid', 'text-red-500');
                showToast("Added to wishlist ❤️");
            }
            
            updateWishlist();
        }

        function updateWishlist() {
            const badge = document.getElementById('wishlist-count');
            const container = document.getElementById('wishlist-items');
            
            if(wishlist.length === 0) {
                badge.classList.add('hidden');
                container.innerHTML = `<div class="flex flex-col items-center justify-center h-full text-center text-gray-400"><i class="fa-regular fa-heart text-4xl mb-3 opacity-20"></i><p>Your wishlist is empty</p></div>`;
            } else {
                badge.innerText = wishlist.length;
                badge.classList.remove('hidden');
                container.innerHTML = wishlist.map((i, idx) => `
                    <div class="flex gap-3 bg-gray-50 p-2 rounded-lg items-center animate-fade-in">
                        <img src="${i.img}" class="w-14 h-14 rounded-md object-cover" alt="${i.title}">
                        <div class="flex-1">
                            <p class="font-bold text-sm text-slate-900">${i.title}</p>
                            <p class="text-xs text-gray-500">${i.price}</p>
                        </div>
                        <button onclick="addWishlistToCart(${idx})" class="text-primary hover:text-primaryDark p-2" title="Add to cart">
                            <i class="fa-solid fa-cart-plus"></i>
                        </button>
                        <button onclick="removeFromWishlist(${idx})" class="text-gray-400 hover:text-red-500 p-2">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }
        }

        function removeFromWishlist(idx) {
            wishlist.splice(idx, 1);
            updateWishlist();
            showToast("Removed from wishlist");
        }

        function addWishlistToCart(idx) {
            cart.push(wishlist[idx]);
            updateCart();
            showToast("Added to cart!");
        }

        function addAllToCart() {
            if(wishlist.length === 0) {
                showToast("Wishlist is empty");
                return;
            }
            
            wishlist.forEach(item => cart.push(item));
            updateCart();
            toggleWishlist();
            toggleCart();
            showToast(`${wishlist.length} items added to cart!`);
        }

        function quickAddToWishlist(item, event) {
            event.stopPropagation(); // Prevent opening details
            
            const index = wishlist.findIndex(w => w.title === item.title);
            
            if(index > -1) {
                wishlist.splice(index, 1);
                showToast("Removed from wishlist");
            } else {
                wishlist.push(item);
                showToast("Added to wishlist ❤️");
            }
            
            updateWishlist();
        }

        // Sort dropdown toggle
        function toggleSortDropdown() {
            const dropdown = document.getElementById('sort-dropdown');
            dropdown.classList.toggle('hidden');
            
            // Close dropdown when clicking outside
            if (!dropdown.classList.contains('hidden')) {
                setTimeout(() => {
                    document.addEventListener('click', function closeDropdown(e) {
                        if (!e.target.closest('#sort-dropdown') && !e.target.closest('button[onclick="toggleSortDropdown()"]')) {
                            dropdown.classList.add('hidden');
                            document.removeEventListener('click', closeDropdown);
                        }
                    });
                }, 100);
            }
        }

        function selectSort(order, label) {
            document.getElementById('sort-label').innerText = label;
            document.getElementById('sort-dropdown').classList.add('hidden');
            sortListings(order);
        }

        // Sort listings
        async function sortListings(order) {
            document.getElementById('listings-grid').innerHTML = '<div class="col-span-full text-center py-12"><i class="fa-solid fa-spinner fa-spin text-3xl text-primary"></i></div>';
            currentListings = await fetchListings(currentCategory, order);
            renderListings(currentListings);
            showToast(`Sorted by price: ${order === 'asc' ? 'Low to High' : 'High to Low'}`);
        }

        // Pincode-based filtering
        let userPincode = null;

        async function searchByLocation() {
            const pincodeInput = document.getElementById('search-pincode');
            const pincode = pincodeInput.value.trim();
            
            if (!pincode) {
                showToast('Please enter a pincode');
                return;
            }
            
            if (pincode.length !== 6) {
                showToast('Please enter a valid 6-digit pincode');
                return;
            }
            
            userPincode = pincode;
            
            // Show loading
            document.getElementById('listings-grid').innerHTML = '<div class="col-span-full text-center py-12"><i class="fa-solid fa-spinner fa-spin text-3xl text-primary"></i><p class="mt-4 text-gray-500">Finding items near you...</p></div>';
            
            // Fetch listings with pincode filter
            try {
                const response = await fetch(`/api/listings?category=${currentCategory}&pincode=${pincode}`);
                const data = await response.json();
                currentListings = data;
                renderListings(data);
                
                if (data.length > 0) {
                    showToast(`Found ${data.length} items near pincode ${pincode}`);
                } else {
                    showToast('No items found in this area');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('Error searching by location');
            }
        }

        async function detectNearMe() {
            // For demo purposes, we'll use a default pincode
            // In production, you'd use browser geolocation API to get coordinates
            // then convert to pincode using a geocoding service
            
            showToast('Detecting your location...');
            
            // Simulate location detection
            setTimeout(() => {
                const defaultPincode = '400001'; // Mumbai pincode for demo
                document.getElementById('search-pincode').value = defaultPincode;
                showToast('Location detected! Click Search to find nearby items.');
            }, 1000);
        }

        // Calculate distance between pincodes (simplified)
        function calculatePincodeDistance(pincode1, pincode2) {
            // Simplified distance calculation based on pincode difference
            // In production, use actual lat/long coordinates
            const diff = Math.abs(parseInt(pincode1) - parseInt(pincode2));
            
            if (diff === 0) return 0;
            if (diff < 10) return 1;
            if (diff < 100) return 5;
            if (diff < 1000) return 20;
            if (diff < 10000) return 50;
            return 100;
        }


        // Filter by subcategory
        function filterBySubcategory(subcategory) {
            // Update active chip
            document.querySelectorAll('.category-chip').forEach(chip => {
                chip.classList.remove('active');
                if(chip.textContent === subcategory) {
                    chip.classList.add('active');
                }
            });

            // Filter listings
            if(subcategory === 'All') {
                renderListings(currentListings);
            } else {
                const filtered = currentListings.filter(item => {
                    const title = item.title.toLowerCase();
                    const sub = subcategory.toLowerCase();
                    const category = item.category ? item.category.toLowerCase() : '';
                    
                    // PRODUCTS - Match by category field
                    if(sub.includes('camera')) {
                        return category === 'cameras';
                    }
                    if(sub.includes('electronics') || sub.includes('electronic')) {
                        return category === 'electronics';
                    }
                    if(sub.includes('vehicle') || sub.includes('bike') || sub.includes('car')) {
                        return category === 'vehicles';
                    }
                    if(sub.includes('furniture')) {
                        return category === 'furniture';
                    }
                    if(sub.includes('sport')) {
                        return category === 'sports';
                    }
                    if(sub.includes('music')) {
                        return category === 'music';
                    }
                    if(sub.includes('fashion')) {
                        return category === 'fashion';
                    }
                    if(sub.includes('tool')) {
                        return category === 'tools';
                    }
                    
                    // SERVICES - Match by category field
                    if(sub.includes('tech')) {
                        return category === 'tech';
                    }
                    if(sub.includes('home')) {
                        return category === 'home';
                    }
                    if(sub.includes('personal')) {
                        return category === 'personal';
                    }
                    if(sub.includes('event')) {
                        return category === 'events';
                    }
                    
                    // SPACES - Match by category field
                    if(sub.includes('vacation')) {
                        return category === 'vacation';
                    }
                    if(sub.includes('apartment')) {
                        return category === 'apartments';
                    }
                    if(sub.includes('office')) {
                        return category === 'offices';
                    }
                    if(sub.includes('hall')) {
                        return category === 'halls';
                    }
                    if(sub.includes('studio') && currentCategory === 'spaces') {
                        return category === 'studios';
                    }
                    
                    return true;
                });
                
                renderListings(filtered);
                showToast(`Filtered: ${subcategory}`);
            }
        }

        // Location detection
        function detectLocation() {
            const btn = document.querySelector('#location-modal button');
            const old = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Locating...';
            
            setTimeout(() => {
                document.getElementById('search-location').value = "Ahmedabad, Gujarat";
                document.getElementById('detail-location').innerText = "Ahmedabad, Gujarat";
                document.getElementById('location-modal').classList.add('hidden');
                btn.innerHTML = old;
                showToast("Location Updated!");
            }, 1000);
        }

        // Search functionality
        async function performSearch() {
            const searchQuery = document.getElementById('search-input').value.trim();
            const pincode = document.getElementById('search-pincode').value.trim();
            
            if (!searchQuery && !pincode) {
                showToast('Please enter a search term or pincode');
                return;
            }
            
            // Show loading
            document.getElementById('listings-grid').innerHTML = '<div class="col-span-full text-center py-12"><i class="fa-solid fa-spinner fa-spin text-3xl text-primary"></i><p class="mt-4 text-gray-500">Searching...</p></div>';
            
            try {
                let results = [];
                
                // Search across all categories
                const categories = ['products', 'services', 'spaces'];
                
                for (const category of categories) {
                    const response = await fetch(`/api/listings?category=${category}`);
                    const data = await response.json();
                    
                    // Filter by search query
                    let filtered = data;
                    
                    if (searchQuery) {
                        filtered = filtered.filter(item => {
                            const title = item.title.toLowerCase();
                            const desc = (item.description || '').toLowerCase();
                            const query = searchQuery.toLowerCase();
                            return title.includes(query) || desc.includes(query);
                        });
                    }
                    
                    // Filter by pincode if provided
                    if (pincode) {
                        filtered = filtered.filter(item => item.pincode === pincode);
                    }
                    
                    results = results.concat(filtered);
                }
                
                // Update section title
                document.getElementById('section-title').innerText = searchQuery ? 
                    `Search results for "${searchQuery}"` : 
                    `Results in ${pincode}`;
                
                // Render results
                if (results.length === 0) {
                    document.getElementById('listings-grid').innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <i class="fa-solid fa-magnifying-glass text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-bold text-slate-900 mb-2">No results found</h3>
                            <p class="text-gray-500">Try different keywords or check your pincode</p>
                        </div>
                    `;
                } else {
                    currentListings = results;
                    renderListings(results);
                    showToast(`Found ${results.length} results`);
                }
                
            } catch (error) {
                console.error('Search error:', error);
                showToast('Search failed. Please try again.');
                document.getElementById('listings-grid').innerHTML = '<div class="col-span-full text-center py-12 text-red-500"><i class="fa-solid fa-exclamation-triangle text-3xl mb-4"></i><p>Error loading results</p></div>';
            }
        }

        // Toast notification
        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 3000);
        }

        // Review System
        let selectedRating = 0;

        function openReviewModal() {
            const user = getCurrentUser();
            if (!user) {
                showToast('Please login to write a review');
                openLoginModal();
                return;
            }
            document.getElementById('review-modal').classList.remove('hidden');
            selectedRating = 0;
            document.querySelectorAll('.rating-star').forEach(star => {
                star.classList.remove('text-yellow-500');
                star.classList.add('text-gray-300');
            });
        }

        function closeReviewModal() {
            document.getElementById('review-modal').classList.add('hidden');
            document.getElementById('review-comment').value = '';
            selectedRating = 0;
        }

        function setRating(rating) {
            selectedRating = rating;
            document.getElementById('review-rating').value = rating;
            
            document.querySelectorAll('.rating-star').forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('text-gray-300');
                    star.classList.add('text-yellow-500');
                } else {
                    star.classList.remove('text-yellow-500');
                    star.classList.add('text-gray-300');
                }
            });
        }

        function submitReview(event) {
            event.preventDefault();
            
            const user = getCurrentUser();
            if (!user) {
                showToast('Please login first');
                return;
            }

            if (selectedRating === 0) {
                showToast('Please select a rating');
                return;
            }

            const comment = document.getElementById('review-comment').value.trim();
            if (!comment) {
                showToast('Please write a review');
                return;
            }

            // Create review object
            const review = {
                itemTitle: currentItem.title,
                userName: user.name,
                userEmail: user.email,
                rating: selectedRating,
                comment: comment,
                date: new Date().toISOString(),
                timestamp: Date.now()
            };

            // Get existing reviews
            let reviews = JSON.parse(localStorage.getItem('rentit_reviews') || '[]');
            reviews.unshift(review); // Add to beginning
            localStorage.setItem('rentit_reviews', JSON.stringify(reviews));

            closeReviewModal();
            showToast('Review submitted successfully! ⭐');
            
            // Reload reviews
            loadReviews();
        }

        function loadReviews() {
            if (!currentItem) return;

            const allReviews = JSON.parse(localStorage.getItem('rentit_reviews') || '[]');
            const itemReviews = allReviews.filter(r => r.itemTitle === currentItem.title);
            
            const reviewsList = document.getElementById('reviews-list');
            const reviewCount = document.getElementById('review-count');
            const showAllBtn = document.getElementById('show-all-reviews-btn');

            reviewCount.innerText = itemReviews.length;

            if (itemReviews.length === 0) {
                reviewsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fa-solid fa-comment-slash text-4xl mb-3 opacity-20"></i>
                        <p>No reviews yet. Be the first to review!</p>
                    </div>
                `;
                showAllBtn.classList.add('hidden');
                return;
            }

            // Show first 3 reviews
            const displayReviews = itemReviews.slice(0, 3);
            
            reviewsList.innerHTML = displayReviews.map(review => {
                const date = new Date(review.date);
                const formattedDate = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                
                return `
                    <div class="flex gap-4">
                        <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(review.userName)}&background=random" class="w-12 h-12 rounded-full">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <div>
                                    <p class="font-semibold text-slate-900">${review.userName}</p>
                                    <p class="text-sm text-gray-500">${formattedDate}</p>
                                </div>
                                <div class="flex items-center gap-1">
                                    ${Array(review.rating).fill('<i class="fa-solid fa-star text-yellow-500 text-sm"></i>').join('')}
                                    <span class="font-semibold text-sm ml-1">${review.rating}.0</span>
                                </div>
                            </div>
                            <p class="text-gray-700">${review.comment}</p>
                        </div>
                    </div>
                `;
            }).join('');

            // Show "Show all" button if more than 3 reviews
            if (itemReviews.length > 3) {
                showAllBtn.classList.remove('hidden');
                showAllBtn.innerText = `Show all ${itemReviews.length} reviews`;
            } else {
                showAllBtn.classList.add('hidden');
            }
        }

        function showAllReviews() {
            alert('Show all reviews feature - coming soon!');
        }

        // Modal controls
        function openLoginModal() { 
            document.getElementById('auth-modal').classList.remove('hidden');
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('signup-form').classList.add('hidden');
        }
        
        function closeAuthModal() {
            document.getElementById('auth-modal').classList.add('hidden');
        }
        
        function switchToSignup() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.remove('hidden');
        }
        
        function switchToLogin() {
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        }
        
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = event.target.closest('button').querySelector('i');
            
            if(input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Authentication handlers - These are defined in firebase-auth.js
        // Just check for user state here
        function getCurrentUser() {
            // Check if currentUser is defined from firebase-auth.js
            if (typeof currentUser !== 'undefined' && currentUser) {
                return currentUser;
            }
            
            // Fallback to localStorage
            const storedUser = JSON.parse(localStorage.getItem('rentit_user') || 'null');
            if (storedUser && storedUser.loggedIn) {
                return storedUser;
            }
            
            return null;
        }

        // Booking Functions
        let bookingItem = null;

        // Calculate price on detail page
        function calculateDetailPrice() {
            const detailStartDate = document.getElementById('detail-start-date');
            const detailEndDate = document.getElementById('detail-end-date');
            
            if (!detailStartDate || !detailEndDate || !detailStartDate.value || !detailEndDate.value) {
                document.getElementById('detail-price-breakdown').innerText = 'Select dates';
                document.getElementById('detail-rental-amount').innerText = '₹0';
                document.getElementById('detail-total-amount').innerText = '₹60';
                return;
            }
            
            const start = new Date(detailStartDate.value);
            const end = new Date(detailEndDate.value);
            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
            
            if (days < 1) {
                document.getElementById('detail-price-breakdown').innerText = 'Select dates';
                document.getElementById('detail-rental-amount').innerText = '₹0';
                document.getElementById('detail-total-amount').innerText = '₹60';
                return;
            }
            
            // Get price from current item
            const priceStr = currentItem.price.replace(/[₹,]/g, '');
            const pricePerDay = parseInt(priceStr) || 0;
            const rentalAmount = pricePerDay * days;
            const serviceFee = 60;
            const total = rentalAmount + serviceFee;
            
            // Format numbers with commas
            const formatPrice = (num) => '₹' + num.toLocaleString('en-IN');
            
            document.getElementById('detail-price-breakdown').innerText = `${currentItem.price} x ${days} day${days > 1 ? 's' : ''}`;
            document.getElementById('detail-rental-amount').innerText = formatPrice(rentalAmount);
            document.getElementById('detail-total-amount').innerText = formatPrice(total);
        }

        function handleRentNow() {
            const user = getCurrentUser();
            
            if (!user) {
                showToast('Please login to continue');
                openLoginModal();
                return;
            }
            
            if (!currentItem) {
                showToast('Please select an item first');
                return;
            }
            
            // Get selected dates from detail page
            const startDate = document.getElementById('detail-start-date').value;
            const endDate = document.getElementById('detail-end-date').value;
            
            // Store dates in localStorage for booking page
            if (startDate && endDate) {
                localStorage.setItem('booking_dates', JSON.stringify({
                    startDate: startDate,
                    endDate: endDate
                }));
            }
            
            // Store item in localStorage and redirect to booking page
            localStorage.setItem('booking_item', JSON.stringify(currentItem));
            window.location.href = '/booking?item=' + encodeURIComponent(JSON.stringify(currentItem));
        }

        function handleCheckout() {
            const user = getCurrentUser();
            
            if (!user) {
                showToast('Please login to continue');
                openLoginModal();
                return;
            }
            
            if (cart.length === 0) {
                showToast('Your cart is empty');
                return;
            }
            
            // Redirect to booking page with first cart item
            localStorage.setItem('booking_item', JSON.stringify(cart[0]));
            window.location.href = '/booking?item=' + encodeURIComponent(JSON.stringify(cart[0]));
        }

        // Share Item
        function shareItem() {
            if (!currentItem) return;
            
            const shareData = {
                title: currentItem.title,
                text: `Check out this ${currentItem.title} on Rentit!`,
                url: window.location.href
            };
            
            if (navigator.share) {
                navigator.share(shareData).catch(() => {
                    copyToClipboard(window.location.href);
                });
            } else {
                copyToClipboard(window.location.href);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Link copied to clipboard!');
            }).catch(() => {
                showToast('Failed to copy link');
            });
        }

        // Contact Host
        function contactHost() {
            if (!currentItem) return;
            
            const user = getCurrentUser();
            if (!user) {
                showToast('Please login to contact host');
                openLoginModal();
                return;
            }
            
            document.getElementById('contact-host-name').innerText = currentItem.hostName || 'Host';
            document.getElementById('contact-host-avatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(currentItem.hostName || 'Host')}&background=4f46e5&color=fff`;
            document.getElementById('contact-modal').classList.remove('hidden');
        }

        function closeContactModal() {
            document.getElementById('contact-modal').classList.add('hidden');
            document.getElementById('contact-message').value = '';
        }

        function sendMessage(event) {
            event.preventDefault();
            const message = document.getElementById('contact-message').value;
            
            // TODO: Implement actual messaging
            showToast('Message sent successfully!');
            closeContactModal();
        }

        // Image Gallery
        let galleryImages = [];
        let currentGalleryIndex = 0;

        function openImageGallery(index) {
            if (!currentItem) return;
            
            // Prepare images array
            if (currentItem.images && currentItem.images.length > 0) {
                galleryImages = currentItem.images;
            } else {
                galleryImages = [currentItem.img, currentItem.img, currentItem.img, currentItem.img, currentItem.img];
            }
            
            currentGalleryIndex = index;
            updateGalleryImage();
            document.getElementById('image-gallery-modal').classList.remove('hidden');
        }

        function closeImageGallery() {
            document.getElementById('image-gallery-modal').classList.add('hidden');
        }

        function nextImage() {
            currentGalleryIndex = (currentGalleryIndex + 1) % galleryImages.length;
            updateGalleryImage();
        }

        function prevImage() {
            currentGalleryIndex = (currentGalleryIndex - 1 + galleryImages.length) % galleryImages.length;
            updateGalleryImage();
        }

        function updateGalleryImage() {
            document.getElementById('gallery-image').src = galleryImages[currentGalleryIndex];
            document.getElementById('gallery-counter').innerText = `${currentGalleryIndex + 1} / ${galleryImages.length}`;
        }

        // Keyboard navigation for gallery
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('image-gallery-modal');
            if (!modal.classList.contains('hidden')) {
                if (e.key === 'ArrowRight') nextImage();
                if (e.key === 'ArrowLeft') prevImage();
                if (e.key === 'Escape') closeImageGallery();
            }
        });

        // Reviews Modal
        function showAllReviews() {
            if (!currentItem) return;
            
            // Update rating in modal
            document.getElementById('reviews-rating').innerText = currentItem.rating || '4.9';
            
            // Show modal
            document.getElementById('reviews-modal').classList.remove('hidden');
        }

        function closeReviewsModal() {
            document.getElementById('reviews-modal').classList.add('hidden');
        }

    </script>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white mt-20">
        <div class="max-w-7xl mx-auto px-6 lg:px-8 py-16">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-12 mb-12">
                <!-- Brand -->
                <div class="lg:col-span-2">
                    <div class="flex items-center gap-2.5 mb-6">
                        <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center">
                            <i class="fa-solid fa-cube text-slate-900 text-lg"></i>
                        </div>
                        <span class="text-2xl font-bold">Rentit</span>
                    </div>
                    <p class="text-gray-400 mb-6 leading-relaxed">
                        India's most trusted rental marketplace. Rent Anything, Experience Everything. From products to services to spaces - we've got you covered.
                    </p>
                    <div class="flex items-center gap-4">
                        <a href="#" class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-lg flex items-center justify-center transition">
                            <i class="fa-brands fa-facebook-f"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-lg flex items-center justify-center transition">
                            <i class="fa-brands fa-twitter"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-lg flex items-center justify-center transition">
                            <i class="fa-brands fa-instagram"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-lg flex items-center justify-center transition">
                            <i class="fa-brands fa-linkedin-in"></i>
                        </a>
                    </div>
                </div>

                <!-- Company -->
                <div>
                    <h3 class="font-bold text-lg mb-4">Company</h3>
                    <ul class="space-y-3">
                        <li><a href="/about" class="text-gray-400 hover:text-white transition">About Us</a></li>
                        <li><a href="/contact" class="text-gray-400 hover:text-white transition">Careers</a></li>
                        <li><a href="/contact" class="text-gray-400 hover:text-white transition">Press</a></li>
                        <li><a href="/policies" class="text-gray-400 hover:text-white transition">Blog</a></li>
                    </ul>
                </div>

                <!-- Support -->
                <div>
                    <h3 class="font-bold text-lg mb-4">Support</h3>
                    <ul class="space-y-3">
                        <li><a href="/help" class="text-gray-400 hover:text-white transition">Help Center</a></li>
                        <li><a href="/complaint" class="text-gray-400 hover:text-white transition">Complaint Box</a></li>
                        <li><a href="/safety" class="text-gray-400 hover:text-white transition">Safety</a></li>
                        <li><a href="/contact" class="text-gray-400 hover:text-white transition">Contact Us</a></li>
                        <li><a href="/faqs" class="text-gray-400 hover:text-white transition">FAQs</a></li>
                    </ul>
                </div>

                <!-- Legal -->
                <div>
                    <h3 class="font-bold text-lg mb-4">Legal</h3>
                    <ul class="space-y-3">
                        <li><a href="/policies#terms" class="text-gray-400 hover:text-white transition">Terms of Service</a></li>
                        <li><a href="/policies#privacy" class="text-gray-400 hover:text-white transition">Privacy Policy</a></li>
                        <li><a href="/policies#cancellation" class="text-gray-400 hover:text-white transition">Cancellation Policy</a></li>
                        <li><a href="/policies" class="text-gray-400 hover:text-white transition">All Policies</a></li>
                    </ul>
                </div>
            </div>

            <!-- Bottom Bar -->
            <div class="pt-8 border-t border-white/10 flex flex-col md:flex-row justify-between items-center gap-4">
                <p class="text-gray-400 text-sm">© 2024 Rentit. All rights reserved.</p>
                <div class="flex items-center gap-6 text-sm text-gray-400">
                    <span>🇮🇳 India</span>
                    <span>English</span>
                    <span>₹ INR</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Firebase Authentication -->
    <script src="/static/js/firebase-auth.js"></script>
    
    <script>
        // Cinematic Splash Screen Logic
        window.addEventListener('DOMContentLoaded', function() {
            const brandContainer = document.getElementById('brand-container');
            const splash = document.getElementById('splash-screen');
            
            // Show text after logo appears
            setTimeout(() => {
                brandContainer.classList.add('show-text');
            }, 700);
            
            // Fade out splash screen
            setTimeout(() => {
                splash.classList.add('fade-out');
            }, 2800);
            
            // Remove from DOM after animation
            setTimeout(() => {
                splash.style.display = 'none';
            }, 4000);
        });
    </script>
</body>
</html>